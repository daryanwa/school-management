import { PrismaClient } from "../generated/prisma/client";
import { PrismaPg } from '@prisma/adapter-pg';
import 'dotenv/config'
import { Pool } from "pg";

const pool = new Pool({ connectionString: process.env.DATABASE_URL });  // pg из вашего package.json
const adapter = new PrismaPg(pool);

const prismaClientSingleton = () => {
    return new PrismaClient({adapter})
  }
  
  declare const globalThis: {
    prismaGlobal: ReturnType<typeof prismaClientSingleton>;
  } & typeof global;
  
  const prisma = globalThis.prismaGlobal ?? prismaClientSingleton()
  
  export default prisma
  
  if (process.env.NODE_ENV !== 'production') globalThis.prismaGlobal = prisma